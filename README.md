# csharp-win-service
C#中Windows服务开发对于.NET程序员来说一定并不陌生，本文整理了一些个人对Windows服务开发的一些经验，欢迎下载学习，希望对你在开发中有所帮助。<br />

本文对Windows服务创建、添加安装器、设置的过程忽略，可以自行去网上寻求答案，或者可以私聊本人。本文主要介绍在一个服务中只设置一个定时器，如何执行多个计划任务。<br />

设置定时器每隔一分钟执行一次（当然如果你有其他的需求，需要单位到秒级别，你可以自己按照以下思路同理设置），每次取定时器的SignalTime进行判断。<br />

每n分钟执行一次且上一次执行结束后开始执行本次操作（当然如果你能完全确保每次执行都能在一个执行中完成，则可以不用判断上一次是否结束） ；这种方式有一个要注意的地方：当n设置为7时，那么当前小时内最后一次执行时间为56分钟，紧接着到达下一小时的0分钟又会开始执行，也就是在下一小时的最后一次执行和当前小时的第一次执行之间时间间隔是4分钟，而不是7分钟，同理只要n设置成不能被60整除的数值 ，任务都会有这种问题的存在，所以在设置n时，最好设置为能被60整除的数值.<br />

如果要设置每小时03分的时候执行一次（如 01:03，02:03 ...） ：<br />
if (iMinute == 3)<br />
如果要设置每两小时执行一次可设置如下判断（注意小时的设置千万不能为0）<br />
if (iHour%2 == 1 && iMinute == 3)            // 表示每两小时03分执行一次（如 01:03，03:03 ...）<br />
或者 if (iHour%2 == 0 && iMinute == 3)    // 表示每两小时03分执行一次（如 00:03，02:03 ...）<br />
同理每三小时、每四小时...执行一次把iHour对n取余等于0便可，注意iMinute条件一定要设置， <br />否则会变成每n小时内每次定时器执行都会执行执行体<br />

如果要设置每天执行一次那么可以设置如下判断：<br />
if (iHour == 0 && iMinute == 0)           // 表示每天00:00执行一次<br />

以上配置有一个前提条件：在一个定时器中执行多个计划任务，这种设置是非常有效的，个人觉得这样设置比起在一个服务里面设置多个定时器更为有效。<br />

再推荐大家一个.NET作业调度框架——Quartz.NET，Quartz是一个开源的作业调度框架，非常强大，有兴趣可以去了解一下，这里不作过多的详述 。<br />

我把编译好的程序放在Debug文件夹中，只要运行install.bat执行安装服务，运行uninstall.bat便可以卸载服务。服务运行时可以设置任务执行时间（这里简单放了一个睡眠时间来观看效果，你可以自行设置并运行服务）。<br />